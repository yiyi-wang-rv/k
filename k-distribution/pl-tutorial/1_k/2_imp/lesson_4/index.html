<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />
<link rel="canonical" href="https://kframework.org/k-distribution/pl-tutorial/1_k/2_imp/lesson_4/" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../../assets/img/favicon.ico" />

<title>K | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px;"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../../downloads">K Tool Binaries </a>
      <a class="bd-toc-link" href="../../../../../k-distribution/k-tutorial"
        >K Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../k-distribution/pl-tutorial"
        >K PL Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../USER_MANUAL/">K User Manual </a>
      <a
        class="bd-toc-link"
        href="../../../../../k-distribution/include/kframework/builtin/"
        >K Builtins
      </a>
      <a class="bd-toc-link" href="../../../../../projects">Projects using K</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><!-- Copyright (c) 2010-2019 K Team. All Rights Reserved. --><html><head></head><body><h1 id="configuration-abstraction%2C-part-1%3B-types-of-rules">Configuration Abstraction, Part 1; Types of Rules</h1>
<p>Here we will complete the K definition of IMP and, while doing so, we will
learn the very first step of what we call <em>configuration abstraction</em>, and
the semantic distinction between structural and computational rules.</p>
<h2 id="the-imp-semantic-rules">The IMP Semantic Rules</h2>
<p>Let us add the remaining rules, in the order in which the language constructs
were defined in IMP-SYNTAX.</p>
<p>The rules for the arithmetic and Boolean constructs are self-explanatory.
Note, however, that K will infer the correct sorts of all the variables in
these rules, because they appear as arguments of the builtin operations
(<code>_+Int_</code>, etc.). Moreover, the inferred sorts will be enforced dynamically.
Indeed, we do not want to apply the rule for addition, for example, when the
two arguments are not integers. In the rules for <code>&amp;&amp;</code>, although we prefer to
not do it here for simplicity, we could have eliminated the dynamic check by
replacing <code>B</code> (and similarly for <code>_</code>) with <code>B:K</code>. Indeed, it can be shown
that whenever any of these rules apply, <code>B</code> (or <code>_</code>) is a <code>BExp</code> anyway.
That&apos;s because there is no rule that can touch such a <code>B</code> (or <code>_</code>); this
will become clearer shortly, when we discuss the first step of configuration
abstraction. Therefore, since we know that <code>B</code> will be a <code>BExp</code> anyway, we
could save the time it takes to check its sort; such times may look minor,
but they accumulate, so some designers may prefer to avoid run-time checks
whenever possible.</p>
<p>The block rules are trivial. However, the rule for non-empty blocks is
semantically correct only because we do not have local variable declarations
in IMP. We will have to change this rule in IMP++.</p>
<p>The assignment rule has two <code>=&gt;</code>: one in the <code>k</code> cell dissolving the
assignment statement, and the other in the <code>state</code> cell updating the value of
the assigned variable. Note that the one in the <code>state</code> is surrounded by
parentheses: <code>(_ =&gt; I)</code>. That is because <code>=&gt;</code> is greedy: it matches as much
as it can to the left and to the right, until it reaches the cell boundaries
(closed or open). If you want to limit its scope, or for clarity, you can use
parentheses like here.</p>
<p>The rule for sequential composition simply desugars <code>S1 S2</code> into <code>S1 ~&gt; S2</code>.
Indeed, the two have exactly the same semantics. Note that statements
<em>evaluate</em> to nothing (<code>.</code>), so once <code>S1</code> is processed in <code>S1 ~&gt; S2</code>, then the
next task is automatically <code>S2</code>, without wasting any step for the transition.</p>
<p>The rules for the conditional and while statements are clear. One thing to
keep in mind now is that the <code>while</code> unrolling rule will not apply
indefinitely in the positive branch of the resulting conditional, because
of K&apos;s configuration abstraction, which will be discussed shortly.</p>
<p>An IMP program declares a set of variables and then executes a
statement in the state obtained after initializing all those variables
to <code>0</code>. The rules for programs initialize the declared variables one by one,
checking also that there are no duplicates. We check for duplicates only for
demonstration purposes, to illustrate the <code>keys</code> predefined operation that
returns the set of keys of a map, and the set membership operation <code>in</code>.
In practice, we typically define a static type checker for our language,
which we execute before the semantics and reject inappropriate programs.</p>
<p>The use of the <code>.Ids</code> in the second rule is not necessary. We could have
written <code>int; S</code> instead of <code>int .Ids; S</code> and the K tool would parse it and
kompile the definition correctly, because it uses the same parser used for
parsing programs also to parse the semantics. However, we typically prefer to
explicitly write the <em>nothing</em> values in the semantics, for clarity;
the parser has been extended to accept these. Note that the first rule
matches the entire <code>k</code> cell, because <code>int_;_</code> is the top-level program
construct in IMP, so there is nothing following it in the computation cell.
The anonymous variable stands for the second argument of this top-level program
construct, not for the rest of the computation. The second rule could have
also been put in a complete <code>k</code> cell, but we preferred not to, for simplicity.</p>
<p>Our IMP semantics is now complete, but there are a few more things that we
need to understand and do.</p>
<h2 id="configuration-abstraction%2C-part-1">Configuration Abstraction, Part 1</h2>
<p>First, let us briefly discuss the very first step of configuration abstraction.
In K, all semantic rules are in fact rules between configurations. As soon
explained in the IMP++ tutorial, the declared configuration cell structure is
used to automatically complete the missing configuration parts in rules.
However, many rules do not involve any cells, being rules between syntactic
terms (of sort <code>K</code>); for example, we had only three rules involving cells in our
IMP semantics. In this case, the <code>k</code> cell will be added automatically and the
actual rewrite will happen on top of the enclosed computation. For example,
the rule for the <code>while</code> loop is automatically translated into the following:</p>
<pre><code>rule &lt;k&gt; while (B) S =&gt; if (B) {S while (B) S} else {} ...&lt;/k&gt;
</code></pre>
<p>Since the first task in computations is what needs to be done next, the
intuition for this rule completion is that the syntactic transition
only happens when the term to rewrite is ready for processing. This explains,
for example, why the while loop unrolling does not indefinitely apply in the
positive branch of the conditional: the inner while loop is not ready for
evaluation yet. We call this rule completion process, as well as other
similar ones, <em>configuration abstraction</em>. That is because the incomplete
rule abstracts away the configuration structure, thus being easier to read.
As seen soon when we define IMP++, configuration abstraction is not only a
user convenience; it actually significantly increases the modularity of our
definitions. The k-cell-completion is only the very first step, though.</p>
<p>If you really want certain rewrites over syntactic terms to apply
anywhere they match, then you should tag the rule with the attribute
<code>anywhere</code>, which was discussed in Tutorial 1, Lesson 2.5.</p>
<h2 id="structural-vs.-computational-rules">Structural vs. Computational Rules</h2>
<p>The K rules are of two types: structural and computational. Intuitively,
structural rules rearrange the configuration so that computational rules can
apply. Structural rules therefore do not count as computational steps. A K
semantics can be thought of as a generator of transition systems, one for each
program. It is only the computational rules that create steps, or transitions,
in the corresponding transition system, the structural rules being unobservable
at this level. By default, rules are all assumed computational, except for
the implicit heating/cooling rules that define evaluation strategies of
language constructs, which are assumed structural. If you want to explicitly
make a rule structural, then you should include the tag (or attribute)
<code>structural</code> in square brackets right after the rule. These attributes may be
taken into account by different K tools, so it is highly recommended to spend
a moment or two after each rule and think whether you want it to be structural
or computational.</p>
<p>Let us do it. We want the lookup and the arithmetic and Boolean construct
rules to be computational, because they make computational progress whenever
they apply. However, the block rules can be very well structural, because
we can regard them simply as syntactic grouping constructs. In general,
we want to have as few computational rules as possible, because we want
the resulting transition systems to be smaller for analysis purposes, but not
too few to lose behaviors. For example, making the block rules structural
loses no meaningful behaviors. Similarly, the sequential composition,
the while loop unrolling, and the no-variable declaration rules can all
safely be structural.</p>
<p>Kompile and then krun the programs that you only parsed in Lesson 1. They
should all execute as expected. The state cell shows the final state
of the program. The <code>k</code> cell shows the final code contents, which should be
empty whenever the IMP program executes correctly.</p>
<p>Kompile also with the documentation option and take a look at the generated
documentation. The assignment rule should particularly be of interest,
because it contains two local rewrites.</p>
<p>In the next lesson we comment the IMP definition and conclude this tutorial.</p>
<p>Go to <a href="../lesson_5/">Lesson 5, IMP: Completing and Documenting IMP</a>.</p>
<p><a href="https://youtu.be/fR2VEfGHtho" target="_blank" rel="noopener">MOVIE (out of date) [09&apos;16&quot;]</a></p>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;" open>
            <summary class="bd-toc-link-wrapper">
              <a href="#configuration-abstraction%2C-part-1%3B-types-of-rules" class="bd-toc-link">Configuration Abstraction, Part 1; Types of Rules</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#the-imp-semantic-rules"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                The IMP Semantic Rules
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#configuration-abstraction%2C-part-1"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Configuration Abstraction, Part 1
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#structural-vs.-computational-rules"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Structural vs. Computational Rules
              </a></div>
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2022 © all rights reserved</p>
      </div>
    </div>
  </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../../assets/js/index.js"></script>
    <script>
      $(function () {
        // Render youtube video
        const anchorElements = document.querySelectorAll(".markdown-preview a");
        for (let i = anchorElements.length - 1; i >= 0; i--) {
          if (anchorElements.length - 1 - i > 3) {
            break;
          }
          const anchorElement = anchorElements[i];
          const href = anchorElement.getAttribute("href");
          if (href.match(/^https?:\/\/youtu.be\//)) {
            const match = href.match(/^https?:\/\/youtu.be\/(.+?)$/);
            if (match && match[1]) {
              const youtubeId = match[1];
              const $iframe = $(`
<div style="text-align:center;">
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/${youtubeId}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="max-width: 100%;"
  ></iframe>
  <p>The video is out of date</p>
</div>
`);
              $(anchorElement).replaceWith($iframe[0]);
            }
          }
        }
      });
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
