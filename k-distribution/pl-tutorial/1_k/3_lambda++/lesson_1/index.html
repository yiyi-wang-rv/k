<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />
<link rel="canonical" href="https://kframework.org/k-distribution/pl-tutorial/1_k/3_lambda++/lesson_1/" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../../assets/img/favicon.ico" />

<title>K | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px;"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../../downloads">K Tool Binaries </a>
      <a class="bd-toc-link" href="../../../../../k-distribution/k-tutorial"
        >K Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../k-distribution/pl-tutorial"
        >K PL Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../USER_MANUAL/">K User Manual </a>
      <a
        class="bd-toc-link"
        href="../../../../../k-distribution/include/kframework/builtin/"
        >K Builtins
      </a>
      <a class="bd-toc-link" href="../../../../../projects">Projects using K</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><!-- Copyright (c) 2012-2019 K Team. All Rights Reserved. --><html><head></head><body><h1 id="abrupt-changes-of-control">Abrupt Changes of Control</h1>
<p>Here we add <em>call-with-current-continuation</em> (<code>callcc</code>) to the definition of
LAMBDA completed in Tutorial 1, and call the resulting language LAMBDA++.
While doing so, we will learn how to define language constructs that
abruptly change the execution control flow.</p>
<p>Take over the <code>lambda.k</code> definition from Lesson 8 in Part 1 of this Tutorial,
which is the complete definition of the LAMBDA language, but without the
comments.</p>
<p><code>callcc</code> is a good example for studying the capabilities of a framework to
support abrupt changes of control, because it is one of the most
control-intensive language constructs known.  Scheme is probably the first
programming language that incorporated the <code>callcc</code> construct, although
similar constructs have been recently included in many other languages in
one form or another.</p>
<p>Here is a quick description: <code>callcc e</code> passes the remaining computation
context, packaged as a function <code>k</code>, to <code>e</code> (which is expected to be a function);
if during its evaluation <code>e</code> passes any value to <code>k</code>, then the current
execution context is discarded and replaced by the one encoded by <code>k</code> and
the value is passed to it; if <code>e</code> evaluates normally to some value <code>v</code> and
passes nothing to <code>k</code> in the process, then <code>v</code> is returned as a result of
<code>callcc e</code> and the execution continues normally.  For example, we want the
program <code>callcc-jump.lambda</code>:</p>
<pre><code>(callcc (lambda k . ((k 5) + 2))) + 10
</code></pre>
<p>to evaluate to <code>15</code>, not <code>17</code>!  Indeed, the computation context <code>[] + 10</code> is
passed to <code>callcc</code>&apos;s argument, which then sends it a <code>5</code>, so the computation
resumes to <code>5 + 10</code>.  On the other hand, the program <code>callcc-not-jump.lambda</code></p>
<pre><code>(callcc (lambda k . (5 + 2))) + 10
</code></pre>
<p>evaluates to <code>17</code>.</p>
<p>If you like playing games, you can metaphorically think of <code>callcc e</code> as
<em>saving your game state in a file and passing it to your friend <code>e</code></em>.
Then <code>e</code> can decide at some moment to drop everything she was doing, load
your game and continue to play it from where you were.</p>
<p>The behavior of many popular control-changing constructs can be obtained
using <code>callcc</code>.  The program <code>callcc-return.lambda</code> shows, for example, how to
obtain the behavior of a <code>return</code> statement, which exits the current execution
context inside a function and returns a value to the caller&apos;s context:</p>
<pre><code>letrec f x = callcc (lambda return . (
  f (if (x &lt;= 0) then ((return 1) / 0) else 2)
))
in (f -3)
</code></pre>
<p>This should evaluate to <code>1</code>, in spite of the recursive call to <code>f</code>
and of the division by zero!  Note that <code>return</code> is nothing but a variable
name, but one which is bound to the current continuation at the beginning of
the function execution.  As soon as <code>1</code> is passed to <code>return</code>, the computation
jumps <em>back in time</em> to where <code>callcc</code> was defined! Change <code>-3</code> to <code>3</code> and the
program will loop forever.</p>
<p><code>callcc</code> is quite a powerful and beautiful language construct, although one
which is admittedly hard to give semantics to in some frameworks.
But not in K :)  Here is the entire K syntax and semantics of <code>callcc</code>:</p>
<pre><code>syntax Exp ::= &quot;callcc&quot; Exp  [strict]
syntax Val ::= cc(K)
rule &lt;k&gt; (callcc V:Val =&gt; V cc(K)) ~&gt; K &lt;/k&gt;
rule &lt;k&gt; cc(K) V ~&gt; _ =&gt;  V ~&gt; K &lt;/k&gt;
</code></pre>
<p>Let us first discuss the annotated syntax.  We declared <code>callcc</code> strict,
because its argument may not necessarily be a function yet, so it may need
to be evaluated.  As explained above, we need to encode the remaining
computation somehow and pass it to <code>callcc</code>&apos;s argument.  More specifically,
since LAMBDA is call-by-value, we have to encode the remaining computation as
a value.  We do not want to simply subsort computations to <code>Val</code>, because there
are computations which we do not want to be values.  A simple solution to
achieve our goal here is to introduce a new value construct, say <code>cc</code> (from
<em>current-continuation</em>), which holds any computation.</p>
<p>Note that, inspired from <a href="http://www.program-transformation.org/Sdf/" target="_blank" rel="noopener">SDF</a>,
K allows you to define the syntax of helping semantic operations, like <code>cc</code>,
more compactly.  Typically, we do not need a fancy syntax for such operators;
all we need is a name, followed by open parenthesis, followed by a
comma-separated list of arguments, followed by closed parenthesis.  If this
is the syntax that you want for a particular construct, then K allows you to
drop all the quotes surrounding the terminals, as we did above for <code>cc</code>.</p>
<p>The semantic rules do exactly what the English semantics of <code>callcc</code> says.
Note that here, unlike in our definition of LAMBDA in Tutorial 1, we had
to mention the cell <code>&lt;k/&gt;</code> in our rules.  This is because we need to make sure
that we match the entire remaining computation, not only a fragment of it!
For example, if we replace the two rules above with</p>
<pre><code>rule (callcc V:Val =&gt; V cc(K)) ~&gt; K
rule cc(K) V ~&gt; _ =&gt;  V ~&gt; K
</code></pre>
<p>then we get a <code>callcc</code> which is allowed to non-deterministically pick a
prefix of the remaining computation and pass it to its argument, and then
when invoked within its argument, a non-deterministic prefix of the new
computation is discarded and replaced by the saved one.  Wow, that would
be quite a language!  Would you like to write programs in it?  :)</p>
<p>Consequently, in K we can abruptly change the execution control flow of a
program by simply changing the contents of the <code>&lt;k/&gt;</code> cell.  This is one of
the advantages of having an explicit representation of the execution context,
like in K or in reduction semantics with evaluation contexts.  Constructs like
<code>callcc</code> are very hard and non-elegant to define in frameworks such as SOS,
because those implicitly represent the execution context as proof context,
and the latter cannot be easily changed.</p>
<p>Now that we know how to handle cells in configurations and use them in rules,
in the next lesson we take a fresh look at LAMBDA and define it using
an environment-based style, which avoids the complexity of substitution
(e.g., having to deal with variable capture) and is closer in spirit to how
functional languages are implemented.</p>
<p>Go to <a href="../lesson_2/">Lesson 2, LAMBDA++: Semantic (Non-Syntactic) Computation Items</a>.</p>
<p><a href="https://youtu.be/UZ9iaus024g" target="_blank" rel="noopener">MOVIE (out of date) [6&apos;28&quot;]</a></p>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#abrupt-changes-of-control"
                class="bd-toc-link"
                style="padding-left: 0px;;"
              >
                Abrupt Changes of Control
              </a></div>
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/hKLtCjeEd6yqfzwx5" target="_blank"
            >1807 S Neil Street, Champaign, IL 61820</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2022 © all rights reserved</p>
      </div>
    </div>
  </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../../assets/js/index.js"></script>
    <script>
      $(function () {
        // Render youtube video
        const anchorElements = document.querySelectorAll(".markdown-preview a");
        for (let i = anchorElements.length - 1; i >= 0; i--) {
          if (anchorElements.length - 1 - i > 3) {
            break;
          }
          const anchorElement = anchorElements[i];
          const href = anchorElement.getAttribute("href");
          if (href.match(/^https?:\/\/youtu.be\//)) {
            const match = href.match(/^https?:\/\/youtu.be\/(.+?)$/);
            if (match && match[1]) {
              const youtubeId = match[1];
              const $iframe = $(`
<div style="text-align:center;">
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/${youtubeId}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="max-width: 100%;"
  ></iframe>
  <p>The video is out of date</p>
</div>
`);
              $(anchorElement).replaceWith($iframe[0]);
            }
          }
        }
      });
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
