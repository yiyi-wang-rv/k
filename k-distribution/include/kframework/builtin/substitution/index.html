<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../../assets/img/favicon.ico" />

<title>
  K | Runtime Verification Inc
</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px;"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/kframework/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../../downloads">Downloads</a>
      <a class="bd-toc-link" href="../../../../../k-distribution/tutorial"
        >K Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../pending-documentation/"
        >User documentation</a
      >
      <a
        class="bd-toc-link"
        href="../../../../../k-distribution/include/kframework/builtin/"
        >Builtins</a
      >
      <a class="bd-toc-link" href="../../../../../projects">Projects using K</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><html><head></head><body><h1 id="capture-aware-substitution-in-k">Capture-Aware Substitution in K</h1>
<p>One of the traditional ways in which functional languages are given operational
semantics is via substitution. In particular, you can view a function as
declaring a particular bound variable, the parameter of the function, as well
as the body of the function, within which both bound and free variables can
occur, and implement the process of beta-reduction (one of the axioms of the
lambda calculus) by means of a substitution operator which is aware of the
difference between free variables and bound variables and prevents variable
capture.</p>
<p>In K this is implemented using two mechanisms: The <code>KVar</code> sort, and the
<code>binder</code> attribute.</p>
<h2 id="the-kvar-sort">The <code>KVar</code> Sort</h2>
<p>K introduces a new hooked sort, <code>KVar</code>, which the substitution operator
(defined below) understands in a particular way. The syntax of <code>KVar</code> is the
same as for sort <code>Id</code> in <code>DOMAINS</code>, but with a different sort name. Similarly,
some of the same operators are defined over <code>KVar</code> which are defined for <code>Id</code>,
such as conversion from <code>String</code> to <code>KVar</code> and support for the <code>!Var:KVar</code>
syntax.</p>
<p>A <code>KVar</code> is simply an identifier with special meaning during substitution.
<code>KVar</code>s must begin with a letter or underscore,
and can be followed by zero or more letters, numbers, or underscores.</p>
<pre class="language-k"><code><span class="token keyword">module</span> KVAR<span class="token operator">-</span>SYNTAX<span class="token operator">-</span>PROGRAM<span class="token operator">-</span>PARSING
  <span class="token keyword">imports</span> BUILTIN<span class="token operator">-</span>ID<span class="token operator">-</span>TOKENS

  <span class="token keyword">syntax</span> KVar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> r<span class="token string">&quot;(?&lt;![A-Za-z0-9\\_])[A-Za-z\\_][A-Za-z0-9\\_]*&quot;</span>     <span class="token punctuation">[</span>prec<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">token</span><span class="token punctuation">]</span>
                <span class="token operator">|</span> #LowerId                                             <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
                <span class="token operator">|</span> #UpperId                                             <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> KVAR<span class="token operator">-</span>SYNTAX
  <span class="token keyword">syntax</span> KVar <span class="token punctuation">[</span><span class="token class-name">token</span><span class="token punctuation">,</span> hook<span class="token punctuation">(</span>KVAR<span class="token punctuation">.</span>KVar<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> KVAR<span class="token operator">-</span>COMMON
  <span class="token keyword">imports</span> KVAR<span class="token operator">-</span>SYNTAX
  <span class="token keyword">imports</span> STRING

  <span class="token keyword">syntax</span> KVar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> String2KVar <span class="token punctuation">(</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>string2token<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> KVar <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> freshKVar<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span>    <span class="token punctuation">[</span>freshGenerator<span class="token punctuation">,</span> function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> KVAR<span class="token operator">-</span>SYMBOLIC <span class="token punctuation">[</span>symbolic<span class="token punctuation">,</span> kast<span class="token punctuation">]</span>
  <span class="token keyword">imports</span> KVAR<span class="token operator">-</span>COMMON

  <span class="token keyword">syntax</span> KItem  <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;#parseToken&quot;</span>  <span class="token string">&quot;(&quot;</span> <span class="token keyword">String</span> <span class="token string">&quot;,&quot;</span> <span class="token keyword">String</span> <span class="token string">&quot;)&quot;</span>  <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>#parseKVar<span class="token punctuation">)</span><span class="token punctuation">,</span> hook<span class="token punctuation">(</span>STRING<span class="token punctuation">.</span>parseToken<span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> String2KVar<span class="token punctuation">(</span>S<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>#parseToken<span class="token punctuation">(</span><span class="token string">&quot;KVar&quot;</span><span class="token punctuation">,</span> S<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;KVar
<span class="token keyword">endmodule</span>

<span class="token keyword">module</span> KVAR
  <span class="token keyword">imports</span> KVAR<span class="token operator">-</span>COMMON
  <span class="token keyword">imports</span> KVAR<span class="token operator">-</span>SYMBOLIC

  <span class="token keyword">rule</span> freshKVar<span class="token punctuation">(</span>I<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> String2KVar<span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span> <span class="token operator">+</span><span class="token keyword">String</span> Int2String<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">endmodule</span>
</code></pre>
<h2 id="the-binder-attribute">The <code>binder</code> Attribute</h2>
<p>A production can be given the attribute <code>binder</code>. Such a production must have
at least two nonterminals. The first nonterminal from left to right must be of
sort <code>KVar</code>, and contains the bound variable. The last nonterminal from left
to right contains the term that is bound. For example, I could describe lambdas
in the lambda calculus with the production
<code>syntax Val ::= &quot;lambda&quot; KVar &quot;.&quot; Exp [binder]</code>.</p>
<h2 id="substitution">Substitution</h2>
<p>K provides a hooked implementation of substitution, currently only implemented
on the Java and LLVM backends. Two variants exist: the first substitutes
a single <code>KVar</code> for a single <code>KItem</code>. The second takes a <code>Map</code> with <code>KVar</code>
keys and <code>KItem</code> values, and substitutes each element in the map atomically.</p>
<p>Internally, this is implemented in the LLVM backend by a combination of
<code>de Bruijn</code> indices for bound variables and names for free variables. Free
variables are also sometimes given a unique numeric identifier in order to
prevent capture, and the rewriter will automatically assign unique names to
such identifiers when rewriting finishes. The names assigned will always begin
with the original name of the variable and be followed by a unique integer
suffix. However, the names assigned after rewriting finishes might be different
from the names that would be assigned if rewriting were to halt prematurely,
for example due to <code>krun --depth</code>.</p>
<pre class="language-k"><code><span class="token keyword">module</span> SUBSTITUTION
  <span class="token keyword">imports</span> MAP
  <span class="token keyword">imports</span> KVAR

  <span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Sort <span class="token string">&quot;[&quot;</span> KItem <span class="token string">&quot;/&quot;</span> KItem <span class="token string">&quot;]&quot;</span>  <span class="token punctuation">[</span>function<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>SUBSTITUTION<span class="token punctuation">.</span>substOne<span class="token punctuation">)</span><span class="token punctuation">,</span> impure<span class="token punctuation">]</span>
  <span class="token keyword">syntax</span> <span class="token punctuation">{</span>Sort<span class="token punctuation">}</span> Sort <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Sort <span class="token string">&quot;[&quot;</span> Map <span class="token string">&quot;]&quot;</span>      <span class="token punctuation">[</span>function<span class="token punctuation">,</span> hook<span class="token punctuation">(</span>SUBSTITUTION<span class="token punctuation">.</span>substMany<span class="token punctuation">)</span><span class="token punctuation">,</span> impure<span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>
      </div>
    </div>
<footer class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 mb-md-0 mb-4">
        <span class="pr-md-5 pr-0 py-3">
          <a href="https://runtimeverification.com" target="_blank">
            <picture>
              <source
                srcset="../../../../../assets/img/rv-logo-dark.png"
                media="(prefers-color-scheme: dark)"
              />
              <img
                class="pr-3 footer-logo"
                src="../../../../../assets/img/rv-logo.png"
                alt="Runtime Verification Inc logo"
              />
            </picture>
          </a>
        </span>
      </div>
      <div class="col-md-6 mb-md-0 mb-4"></div>
      <div class="col-md-4 text-md-right">
        <p class="copyright">
          &copy; 2020 Runtime Verification Inc. All right reserved.
        </p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../../assets/js/index.js"></script>
    <script>
      $(function () {
        // Render youtube video
        const anchorElements = document.querySelectorAll(".markdown-preview a");
        for (let i = anchorElements.length - 1; i >= 0; i--) {
          if (anchorElements.length - 1 - i > 3) {
            break;
          }
          const anchorElement = anchorElements[i];
          const href = anchorElement.getAttribute("href");
          if (href.match(/^https?:\/\/youtu.be\//)) {
            const match = href.match(/^https?:\/\/youtu.be\/(.+?)$/);
            if (match && match[1]) {
              const youtubeId = match[1];
              const $iframe = $(`
<div style="text-align:center;">
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/${youtubeId}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="max-width: 100%;"
  ></iframe>
  <p>The video is out of date</p>
</div>
`);
              $(anchorElement).replaceWith($iframe[0]);
            }
          }
        }
      });
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
