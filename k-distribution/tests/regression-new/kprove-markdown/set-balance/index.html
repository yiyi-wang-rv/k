<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../../assets/img/favicon.ico" />

<title>
  K | Runtime Verification Inc
</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px;"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/kframework/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../../downloads">Downloads</a>
      <a class="bd-toc-link" href="../../../../../k-distribution/pl-tutorial"
        >K Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../../pending-documentation/"
        >User documentation</a
      >
      <a
        class="bd-toc-link"
        href="../../../../../k-distribution/include/kframework/builtin/"
        >Builtins</a
      >
      <a class="bd-toc-link" href="../../../../../projects">Projects using K</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><html><head></head><body><h1 id="set_balance-spec"><code>set_balance</code> spec</h1>
<h2 id="state-model">State Model</h2>
<pre class="language-k"><code>
<span class="token keyword">module</span> SET<span class="token operator">-</span>BALANCE
    <span class="token keyword">imports</span> INT
    <span class="token keyword">imports</span> DOMAINS
    <span class="token keyword">imports</span> COLLECTIONS

    <span class="token keyword">configuration</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set-balance</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> $ACTION<span class="token punctuation">:</span>Action <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>now</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>now</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>events</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>events</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>return-value</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Result <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>return-value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>call-stack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>call-stack</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creationFee</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creationFee</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transferFee</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transferFee</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span> <span class="token attr-name">multiplicity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Map<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>AccountId<span class="token punctuation">:</span>AccountId <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vestingBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vestingBalance</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startingBlock</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startingBlock</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>perBlock</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>perBlock</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Nonce <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>locks</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>Set <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>locks</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set-balance</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="data">Data</h2>
<ul>
<li>An <code>AccountId</code> is an <code>Int</code>.</li>
<li>An <code>Origin</code> is an <code>AccountId</code>, <code>Root</code>, or <code>None</code>.</li>
<li>A <code>Nonce</code> is an optional <code>Int</code>.</li>
<li>An <code>Event</code> records some happenning.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> AccountId <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.AccountId&quot;</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
 <span class="token comment">// ---------------------------------------</span>

    <span class="token keyword">syntax</span> Origin <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> AccountId <span class="token operator">|</span> <span class="token string">&quot;.Root&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;.None&quot;</span>
 <span class="token comment">// -----------------------------------------------</span>

    <span class="token keyword">syntax</span> Nonce <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.Nonce&quot;</span> <span class="token operator">|</span> <span class="token keyword">Int</span>
 <span class="token comment">// -------------------------------</span>

    <span class="token keyword">syntax</span> Event <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> DustEvent <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// ----------------------------------</span>
</code></pre>
<p>Some predicates which help specifying behavior:</p>
<ul>
<li><code>#inWidth</code>: Specify that a given number is in some bitwidth.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #inWidth<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------</span>
    <span class="token keyword">rule</span> #inWidth<span class="token punctuation">(</span>N<span class="token punctuation">,</span> M<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token operator">&lt;=</span><span class="token keyword">Int</span> M andBool M &lt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">^</span><span class="token keyword">Int</span> N<span class="token punctuation">)</span>
</code></pre>
<h2 id="results">Results</h2>
<p>A <code>Result</code> is the return value of an execution step.</p>
<ul>
<li><code>AccountKilled</code> indicates that the free balance goes below the existential threshold.</li>
<li><code>Updated</code> indicates that an account was updated successfully.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Result <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;.Result&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;AccountKilled&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;Updated&quot;</span>
 <span class="token comment">// ---------------------------------------------------------</span>
</code></pre>
<h2 id="public-getters">Public Getters</h2>
<h3 id="total_balance"><code>total_balance</code></h3>
<p>Retrieves the total balance of an account.  This includes both the free and
reserved balances.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;total_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> total_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span>
</code></pre>
<h3 id="free_balance"><code>free_balance</code></h3>
<p>Gets the free balance of an account.</p>
<p>Other than when this module is executing, this will never be strictly between
<code>EXISTENTIAL_DEPOSIT</code> and zero.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;free_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span>    free_balance<span class="token punctuation">(</span>_<span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> FREE_BALANCE <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="reserved_balance"><code>reserved_balance</code></h3>
<p>Gets the reserved balance of an account.</p>
<p>Other than when this module is executing, this will never be strictly between
<code>EXISTENTIAL_DEPOSIT</code> and zero.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;reserved_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span>    reserved_balance<span class="token punctuation">(</span>_<span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> FREE_BALANCE <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="can_slash"><code>can_slash</code></h3>
<p>Determines if an account&#x2019;s free balance is over the value provided.  This is
often used to determine if an account has enough balance to cover a potential
slash, hence the name.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;can_slash&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span>    can_slash<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span>        <span class="token operator">=&gt;</span> <span class="token boolean">false</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> can_slash<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> FREE_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> AMOUNT <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="total_issuance"><code>total_issuance</code></h3>
<p>Retrieves the total outstanding amount of currency outstanding.  This will
always be equal to the sum of all free and reserved balances in all active
accounts, except when the balances module is executing.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;total_issuance&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> total_issuance <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="issue"><code>issue</code></h3>
<p>Issues currency, creating an imbalance.</p>
<p>This is not specified, since these semantics do not include the concept of an
imbalance.  Without the concept of destructors and move semantics, it would be
almost impossible to use correctly.</p>
<h3 id="burn"><code>burn</code></h3>
<p>Burns currency.</p>
<p>This is not part of the semantics for the same reason <code>burn</code> is not.</p>
<h2 id="actions-and-results">Actions and Results</h2>
<p>An <code>Action</code> is an execution step (or the result of an execution step).
An <code>EntryAction</code> is an <code>Action</code> that can be invoked externally.
A <code>Result</code> is considered an <code>Action</code>, as is an <code>EntryAction</code>.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Result <span class="token operator">|</span> EntryAction
 <span class="token comment">// --------------------------------------</span>
</code></pre>
<h3 id="account_exists"><code>account_exists</code></h3>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;account_exists&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span>    account_exists<span class="token punctuation">(</span>_<span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> account_exists<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="create_account"><code>create_account</code></h3>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;create_account&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ----------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> create_account<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span> <span class="token punctuation">.</span>Bag <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="set_free_balance"><code>set_free_balance</code></h3>
<ul>
<li>Updates an accounts balance if the new balance is above the existential threshold.</li>
<li>Kills the account if the balance goes below the existential threshold and the reserved balance is non-zero.</li>
<li>Reaps the account if the balance goes below the existential threshold and the reserved balance is zero.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;set_free_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// --------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> create_account<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> set_free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool account_exists<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>free<span class="token operator">-</span>account<span class="token operator">-</span>updated<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> EXISTENTIAL_DEPOSIT <span class="token operator">&lt;=</span><span class="token keyword">Int</span> BALANCE

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>free<span class="token operator">-</span>account<span class="token operator">-</span>killed<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>events</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>DustEvent<span class="token punctuation">(</span>FREE_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>events</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Nonce <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">EXISTENTIAL_DEPOSIT</span>
       <span class="token attr-name">andBool</span> <span class="token attr-name">0</span> <span class="token attr-name">&lt;Int</span> <span class="token attr-name">RESERVED_BALANCE</span>

    <span class="token attr-name">rule</span> <span class="token attr-name"><span class="token namespace">[free-account-reaped]:</span></span>
         <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> set_free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>events</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>DustEvent<span class="token punctuation">(</span>FREE_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>events</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">(</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
               <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
          <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag
           <span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> BALANCE &lt;<span class="token keyword">Int</span> EXISTENTIAL_DEPOSIT
</code></pre>
<h3 id="set_reserved_balance"><code>set_reserved_balance</code></h3>
<ul>
<li>Updates an accounts balance if the new balance is above the existential threshold.</li>
<li>Kills the account if the balance goes below the existential threshold and the free balance is non-zero.</li>
<li>Reaps the account if the balance goes below the existential threshold and the free balance is zero.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;set_reserved_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> create_account<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> set_reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> notBool account_exists<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>reserved<span class="token operator">-</span>account<span class="token operator">-</span>updated<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> EXISTENTIAL_DEPOSIT <span class="token operator">&lt;=</span><span class="token keyword">Int</span> BALANCE

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>reserved<span class="token operator">-</span>account<span class="token operator">-</span>killed<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>events</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>DustEvent<span class="token punctuation">(</span>RESERVED_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>events</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>nonce</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Nonce <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>nonce</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> RESERVED_BALANCE <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Int</span> <span class="token attr-name">EXISTENTIAL_DEPOSIT</span>
       <span class="token attr-name">andBool</span> <span class="token attr-name">0</span> <span class="token attr-name">&lt;Int</span> <span class="token attr-name">FREE_BALANCE</span>

    <span class="token attr-name">rule</span> <span class="token attr-name"><span class="token namespace">[reserved-account-reaped]:</span></span>
         <span class="token attr-name">&lt;k</span><span class="token punctuation">&gt;</span></span> set_reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>events</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>DustEvent<span class="token punctuation">(</span>RESERVED_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>events</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">(</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
               <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
          <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bag
           <span class="token punctuation">)</span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> BALANCE &lt;<span class="token keyword">Int</span> EXISTENTIAL_DEPOSIT
</code></pre>
<h3 id="set_balance"><code>set_balance</code></h3>
<ul>
<li>Sets the new free balance</li>
<li>Creates suitible imbalances (both positive and negative).</li>
<li>Calls <code>set_free_balance</code> with the new free balance.</li>
<li>Calls <code>set_reserved_balance</code> with the new reserved balance.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;set_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>balance<span class="token operator">-</span>set<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_balance<span class="token punctuation">(</span>_<span class="token punctuation">,</span> WHO<span class="token punctuation">,</span> FREE_BALANCE<span class="token punctuation">,</span> RESERVED_BALANCE<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> set_balance_free<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> FREE_BALANCE<span class="token punctuation">)</span>
         <span class="token operator">~&gt;</span> set_balance_reserved<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> RESERVED_BALANCE<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Helpers for calling <code>set_free_balance</code> and <code>set_reserved_balance</code>.</p>
<ul>
<li>Sets the new free balance</li>
<li>Emits an imbalance event</li>
<li>Helper function for <code>set_balance</code></li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;set_balance_free&quot;</span>     <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;set_balance_reserved&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>balance<span class="token operator">-</span>set<span class="token operator">-</span>free<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_balance_free<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> FREE_BALANCE<span class="token string">&apos;) =&gt; set_free_balance(WHO, FREE_BALANCE&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> ISSUANCE <span class="token operator">=&gt;</span> ISSUANCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>FREE_BALANCE&apos; <span class="token operator">-</span><span class="token keyword">Int</span> free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #inWidth<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> ISSUANCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>FREE_BALANCE&apos; <span class="token operator">-</span><span class="token keyword">Int</span> free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>balance<span class="token operator">-</span>set<span class="token operator">-</span>reserved<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> set_balance_reserved<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> RESERVED_BALANCE<span class="token string">&apos;) =&gt; set_reserved_balance(WHO, RESERVED_BALANCE&apos;</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> ISSUANCE <span class="token operator">=&gt;</span> ISSUANCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>RESERVED_BALANCE&apos; <span class="token operator">-</span><span class="token keyword">Int</span> reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> #inWidth<span class="token punctuation">(</span><span class="token number">96</span><span class="token punctuation">,</span> ISSUANCE <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>RESERVED_BALANCE&apos; <span class="token operator">-</span><span class="token keyword">Int</span> reserved_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="transfer_raw"><code>transfer_raw</code></h3>
<p>Transfer some liquid free balance to another account.</p>
<p><code>transfer</code> will set the <code>FreeBalance</code> of the sender and receiver.
It will decrease the total issuance of the system by the <code>TransferFee</code>.
If the sender&apos;s account is below the existential deposit as a result
of the transfer, the account will be reaped.</p>
<p>The dispatch origin for this call must be <code>Signed</code> by the transactor.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> ExistenceRequirement <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;AllowDeath&quot;</span>
                                  <span class="token operator">|</span> <span class="token string">&quot;KeepAlive&quot;</span>

    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> transfer<span class="token punctuation">(</span>Origin<span class="token punctuation">,</span> AccountId<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">)</span>
                         <span class="token operator">|</span> <span class="token string">&quot;transfer_keep_alive&quot;</span> <span class="token string">&quot;(&quot;</span> Origin <span class="token string">&quot;,&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ---------------------------------------------------------------------------------</span>

    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> rawTransfer<span class="token punctuation">(</span>AccountId<span class="token punctuation">,</span> AccountId<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> ExistenceRequirement<span class="token punctuation">)</span>
 <span class="token comment">// ------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>transfer<span class="token operator">-</span>to<span class="token operator">-</span>raw<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> transfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">:</span>AccountId<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> AllowDeath<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>transfer<span class="token operator">-</span>keep<span class="token operator">-</span>alive<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> transfer_keep_alive<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">:</span>AccountId<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> KeepAlive<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">(</span><span class="token punctuation">.</span> <span class="token operator">=&gt;</span> create_account<span class="token punctuation">(</span>DESTINATION<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">~&gt;</span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span>         account_exists<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">)</span>
       andBool notBool account_exists<span class="token punctuation">(</span>DESTINATION<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>transfer<span class="token operator">-</span>self<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">:</span>AccountId<span class="token punctuation">,</span> ORIGIN<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> account_exists<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>transfer<span class="token operator">-</span>existing<span class="token operator">-</span>account<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> EXISTENCE_REQUIREMENT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> FEE<span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> set_free_balance<span class="token punctuation">(</span>DESTINATION<span class="token punctuation">,</span> DESTINATION_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> ISSUANCE <span class="token operator">=&gt;</span> ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> FEE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transferFee</span><span class="token punctuation">&gt;</span></span> FEE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transferFee</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ORIGIN <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> SOURCE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> DESTINATION <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> DESTINATION_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ORIGIN <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K DESTINATION
       andBool DESTINATION_BALANCE &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool SOURCE_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>AMOUNT <span class="token operator">+</span><span class="token keyword">Int</span> FEE<span class="token punctuation">)</span>
       andBool ensure_can_withdraw<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> Transfer<span class="token punctuation">,</span> SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> FEE<span class="token punctuation">)</span>
       andBool <span class="token punctuation">(</span>EXISTENCE_REQUIREMENT <span class="token operator">==</span>K AllowDeath orBool SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> FEE &gt;<span class="token keyword">Int</span> EXISTENTIAL_DEPOSIT<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>transfer<span class="token operator">-</span>create<span class="token operator">-</span>account<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> rawTransfer<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">:</span>AccountId<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> EXISTENCE_REQUIREMENT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> CREATION_FEE<span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> set_free_balance<span class="token punctuation">(</span>DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> ISSUANCE <span class="token operator">=&gt;</span> ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> CREATION_FEE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>creationFee</span><span class="token punctuation">&gt;</span></span> CREATION_FEE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>creationFee</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ORIGIN <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> SOURCE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> DESTINATION <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> <span class="token number">0</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> ORIGIN <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K DESTINATION
       andBool SOURCE_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>AMOUNT <span class="token operator">+</span><span class="token keyword">Int</span> CREATION_FEE<span class="token punctuation">)</span>
       andBool EXISTENTIAL_DEPOSIT <span class="token operator">&lt;=</span><span class="token keyword">Int</span> AMOUNT
       andBool ensure_can_withdraw<span class="token punctuation">(</span>ORIGIN<span class="token punctuation">,</span> Transfer<span class="token punctuation">,</span> SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> CREATION_FEE<span class="token punctuation">)</span>
       andBool <span class="token punctuation">(</span>EXISTENCE_REQUIREMENT <span class="token operator">==</span>K AllowDeath orBool SOURCE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> CREATION_FEE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> EXISTENTIAL_DEPOSIT<span class="token punctuation">)</span>
</code></pre>
<h3 id="force_transfer"><code>force_transfer</code></h3>
<p>Force a transfer from any account to any other account.  This can only be done by root.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;force_transfer&quot;</span> <span class="token string">&quot;(&quot;</span> Origin <span class="token string">&quot;,&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>force<span class="token operator">-</span>transfer<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> force_transfer<span class="token punctuation">(</span><span class="token punctuation">.</span>Root<span class="token punctuation">,</span> SOURCE<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> transfer<span class="token punctuation">(</span>SOURCE<span class="token punctuation">,</span> DESTINATION<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="withdraw"><code>withdraw</code></h3>
<p>Withdraw funds from an account.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> withdraw<span class="token punctuation">(</span>AccountId<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> WithdrawReason<span class="token punctuation">,</span> ExistenceRequirement<span class="token punctuation">)</span>
 <span class="token comment">// -------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>withdraw<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token comment">// K really needs where clauses</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> withdraw<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> EXISTENCE_REQUIREMENT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> withdrawInner<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> EXISTENCE_REQUIREMENT<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> withdrawInner<span class="token punctuation">(</span>AccountId<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> WithdrawReason<span class="token punctuation">,</span> ExistenceRequirement<span class="token punctuation">)</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>withdrawInner<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> withdrawInner<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">,</span> NEW_BALANCE<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> EXISTENCE_REQUIREMENT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> NEW_BALANCE<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> ISSUANCE <span class="token operator">=&gt;</span> ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span> EXISTENTIAL_DEPOSIT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>existentialDeposit</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> NEW_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">0</span>
       andBool ensure_can_withdraw<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> NEW_BALANCE<span class="token punctuation">)</span>
       andBool <span class="token punctuation">(</span>EXISTENCE_REQUIREMENT <span class="token operator">==</span>K AllowDeath orBool NEW_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> EXISTENTIAL_DEPOSIT<span class="token punctuation">)</span>
</code></pre>
<h2 id="call-frames">Call Frames</h2>
<p>Function call and return.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> CallFrame <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> frame<span class="token punctuation">(</span>continuation<span class="token punctuation">:</span> K<span class="token punctuation">)</span>
    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> call   <span class="token punctuation">(</span> Action <span class="token punctuation">)</span>
                    <span class="token operator">|</span> return <span class="token punctuation">(</span> Result <span class="token punctuation">)</span>
 <span class="token comment">// -----------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>call<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> call<span class="token punctuation">(</span>Action<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> CONT <span class="token operator">=&gt;</span> Action <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>call-stack</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span>List <span class="token operator">=&gt;</span> ListItem<span class="token punctuation">(</span>frame<span class="token punctuation">(</span>CONT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>call-stack</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>return<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> return<span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token operator">~&gt;</span> _ <span class="token operator">=&gt;</span> CONT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>return-value</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> R <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>return-value</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>call-stack</span><span class="token punctuation">&gt;</span></span> ListItem<span class="token punctuation">(</span>frame<span class="token punctuation">(</span>CONT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>call-stack</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>return<span class="token operator">-</span>unit<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">.</span> <span class="token operator">=&gt;</span> CONT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>return-value</span><span class="token punctuation">&gt;</span></span> _ <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Result <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>return-value</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>call-stack</span><span class="token punctuation">&gt;</span></span> ListItem<span class="token punctuation">(</span>frame<span class="token punctuation">(</span>CONT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>call-stack</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Ensure that a given amount can be withdrawn from an account.</p>
<p><strong>FIXME</strong>: we do not account for multiple withdrawl reasons, due to K&#x2019;s
lacking polymorphism.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> WithdrawReason <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;TransactionPayment&quot;</span>
                            <span class="token operator">|</span> <span class="token string">&quot;Transfer&quot;</span>
                            <span class="token operator">|</span> <span class="token string">&quot;Reserve&quot;</span>
                            <span class="token operator">|</span> <span class="token string">&quot;Fee&quot;</span>
                            <span class="token operator">|</span> <span class="token string">&quot;Tip&quot;</span>
 <span class="token comment">// -------------------------------</span>


    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;ensure_can_withdraw&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> WithdrawReason <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> ensure_can_withdraw<span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> ensure_can_withdraw<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> Transfer #Or Reserve<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vestingBalance</span><span class="token punctuation">&gt;</span></span> VESTING_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vestingBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> VESTING_BALANCE &lt;<span class="token keyword">Int</span> BALANCE

    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> ensure_can_withdraw<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>now</span><span class="token punctuation">&gt;</span></span> NOW <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>now</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>locks</span><span class="token punctuation">&gt;</span></span> ACCOUNT_LOCKS <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>locks</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> activeLocks<span class="token punctuation">(</span>ACCOUNT_LOCKS<span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> LockID <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;Election&quot;</span>
                    <span class="token operator">|</span> <span class="token string">&quot;Staking&quot;</span>
                    <span class="token operator">|</span> <span class="token string">&quot;Democracy&quot;</span>
                    <span class="token operator">|</span> <span class="token string">&quot;Phragmen&quot;</span>
 <span class="token comment">// ----------------------------</span>

    <span class="token keyword">syntax</span> AccountLock <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> lock <span class="token punctuation">(</span> id<span class="token punctuation">:</span> LockID<span class="token punctuation">,</span> until<span class="token punctuation">:</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> reasons<span class="token punctuation">:</span> Set <span class="token punctuation">)</span>
 <span class="token comment">// ---------------------------------------------------------------------------------</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Bool</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> activeLock <span class="token punctuation">(</span>AccountLock<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> WithdrawReason<span class="token punctuation">,</span> <span class="token keyword">Int</span>      <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                  <span class="token operator">|</span> activeLocks<span class="token punctuation">(</span>Set<span class="token punctuation">,</span>         <span class="token keyword">Int</span><span class="token punctuation">,</span> WithdrawReason<span class="token punctuation">,</span> <span class="token keyword">Int</span>      <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
                  <span class="token operator">|</span> activeLocks<span class="token punctuation">(</span>List<span class="token punctuation">,</span>        <span class="token keyword">Int</span><span class="token punctuation">,</span> WithdrawReason<span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">klabel</span><span class="token punctuation">(</span>activeLocksAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> activeLock<span class="token punctuation">(</span>AL<span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> NOW &lt;<span class="token keyword">Int</span> until<span class="token punctuation">(</span>AL<span class="token punctuation">)</span> andBool BALANCE &lt;<span class="token keyword">Int</span> amount<span class="token punctuation">(</span>AL<span class="token punctuation">)</span> andBool REASON in reasons<span class="token punctuation">(</span>AL<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> activeLocks<span class="token punctuation">(</span>ALS<span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> activeLocks<span class="token punctuation">(</span>Set2List<span class="token punctuation">(</span>ALS<span class="token punctuation">)</span><span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> activeLocks<span class="token punctuation">(</span><span class="token punctuation">.</span>List<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> RESULT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> RESULT
    <span class="token keyword">rule</span> activeLocks<span class="token punctuation">(</span><span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>AL<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> _<span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">,</span> RESULT <span class="token operator">=&gt;</span> RESULT orBool activeLock<span class="token punctuation">(</span>AL<span class="token punctuation">,</span> NOW<span class="token punctuation">,</span> REASON<span class="token punctuation">,</span> BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="slashing-and-repatriation-of-reserved-balances">Slashing and repatriation of reserved balances</h2>
<p>The first of these is also used by <code>slash</code>.</p>
<ul>
<li><code>slash_reserved</code></li>
<li><code>repatriate_reserved</code></li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;slash_reserved&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>slash<span class="token operator">-</span>reserved<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> slash_reserved<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_reserved_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> maxInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> RESERVED_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ACCOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> minInt<span class="token punctuation">(</span>RESERVED_BALANCE<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;repatriate_reserved&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// -------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>repatriate<span class="token operator">-</span>reserved<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> repatriate_reserved<span class="token punctuation">(</span>SLASHED<span class="token punctuation">,</span> BENEFICIARY<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>BENEFICIARY<span class="token punctuation">,</span> BENEFICIARY_FREE_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> minInt<span class="token punctuation">(</span>SLASHED_RESERVED_BALANCE<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> set_reserved_balance<span class="token punctuation">(</span>SLASHED<span class="token punctuation">,</span> SLASHED_RESERVED_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> minInt<span class="token punctuation">(</span>SLASHED_RESERVED_BALANCE<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> SLASHED <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> SLASHED_RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> BENEFICIARY <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> BENEFICIARY_RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> BENEFICIARY_FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> BENEFICIARY_FREE_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> BENEFICIARY_RESERVED_BALANCE &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool SLASHED <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K BENEFICIARY

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>repatriate<span class="token operator">-</span>reserved<span class="token operator">-</span>same<span class="token operator">-</span>account<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> repatriate_reserved<span class="token punctuation">(</span>SLASHED<span class="token punctuation">,</span> SLASHED<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> unreserve<span class="token punctuation">(</span>SLASHED<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h3 id="slashing">Slashing</h3>
<p>Used to punish a node for violating the protocol.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> slash <span class="token punctuation">(</span> AccountId <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// ------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>slash<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> slash<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ACCOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> FREE_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> AMOUNT

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>slash<span class="token operator">-</span>empty<span class="token operator">-</span>free<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> slash<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> slash_reserved<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT <span class="token operator">-</span><span class="token keyword">Int</span> FREE_BALANCE<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ACCOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">-</span><span class="token keyword">Int</span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> FREE_BALANCE &lt;<span class="token keyword">Int</span> AMOUNT
</code></pre>
<h3 id="reservation-and-unreservation-of-balances">Reservation and unreservation of balances</h3>
<p>Used to move balance from free to reserved and visa versa.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> reserve <span class="token punctuation">(</span> AccountId <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// ---------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>reserve<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> reserve<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_reserved_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> set_free_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ACCOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> _ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> FREE_BALANCE <span class="token operator">&gt;=</span><span class="token keyword">Int</span> AMOUNT
       andBool ensure_can_withdraw<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> Reserve<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> AMOUNT<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Action <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> unreserve <span class="token punctuation">(</span> AccountId <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>
 <span class="token comment">// -----------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>unreserve<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> unreserve<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span>
          <span class="token operator">=&gt;</span> set_free_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> minInt<span class="token punctuation">(</span>AMOUNT<span class="token punctuation">,</span> RESERVED_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token operator">~&gt;</span> set_reserved_balance<span class="token punctuation">(</span>ACCOUNT<span class="token punctuation">,</span> FREE_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> minInt<span class="token punctuation">(</span>AMOUNT<span class="token punctuation">,</span> RESERVED_BALANCE<span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accounts</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> ACCOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>reservedBalance</span><span class="token punctuation">&gt;</span></span> RESERVED_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>reservedBalance</span><span class="token punctuation">&gt;</span></span>
             <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accounts</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="vesting">Vesting</h2>
<ul>
<li><code>locked_at</code> &#x2015; amount currently locked</li>
<li><code>vesting_balance</code> &#x2015; get the balance that cannot currently be withdrawn.</li>
</ul>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;locked_at&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> locked_at<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> maxInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> VESTING_BALANCE <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>PER_BLOCK <span class="token operator">*</span><span class="token keyword">Int</span> maxInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> NOW <span class="token operator">-</span><span class="token keyword">Int</span> STARTING_BLOCK<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>now</span><span class="token punctuation">&gt;</span></span> NOW <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>now</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vestingBalance</span><span class="token punctuation">&gt;</span></span> VESTING_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vestingBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startingBlock</span><span class="token punctuation">&gt;</span></span> STARTING_BLOCK <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startingBlock</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>perBlock</span><span class="token punctuation">&gt;</span></span> PER_BLOCK <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>perBlock</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;vesting_balance&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;)&quot;</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> functional<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> vesting_balance<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> minInt<span class="token punctuation">(</span>FREE_BALANCE<span class="token punctuation">,</span> locked_at<span class="token punctuation">(</span>WHO<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<h2 id="deposits">Deposits</h2>
<p>Deposit into an existing account.</p>
<pre class="language-k"><code>    <span class="token keyword">syntax</span> EntryAction <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;deposit_into_existing&quot;</span> <span class="token string">&quot;(&quot;</span> AccountId <span class="token string">&quot;,&quot;</span> <span class="token keyword">Int</span> <span class="token string">&quot;)&quot;</span>
 <span class="token comment">// ------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>deposit<span class="token operator">-</span>into<span class="token operator">-</span>existing<span class="token punctuation">]</span><span class="token punctuation">:</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>k</span><span class="token punctuation">&gt;</span></span> deposit_into_existing<span class="token punctuation">(</span>WHO<span class="token punctuation">,</span> AMOUNT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>k</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalIssuance</span><span class="token punctuation">&gt;</span></span> TOTAL_ISSUANCE <span class="token operator">=&gt;</span> TOTAL_ISSUANCE <span class="token operator">+</span><span class="token keyword">Int</span> AMOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalIssuance</span><span class="token punctuation">&gt;</span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>account</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>accountID</span><span class="token punctuation">&gt;</span></span> WHO <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>accountID</span><span class="token punctuation">&gt;</span></span>
           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>freeBalance</span><span class="token punctuation">&gt;</span></span> FREE_BALANCE <span class="token operator">=&gt;</span> FREE_BALANCE <span class="token operator">+</span><span class="token keyword">Int</span> AMOUNT <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>freeBalance</span><span class="token punctuation">&gt;</span></span>
           <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>account</span><span class="token punctuation">&gt;</span></span>
      <span class="token keyword">requires</span> FREE_BALANCE &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<p>End of module</p>
<pre class="language-k"><code><span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>
      </div>
    </div>
<footer class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-2 mb-md-0 mb-4">
        <span class="pr-md-5 pr-0 py-3">
          <a href="https://runtimeverification.com" target="_blank">
            <picture>
              <source
                srcset="../../../../../assets/img/rv-logo-dark.png"
                media="(prefers-color-scheme: dark)"
              />
              <img
                class="pr-3 footer-logo"
                src="../../../../../assets/img/rv-logo.png"
                alt="Runtime Verification Inc logo"
              />
            </picture>
          </a>
        </span>
      </div>
      <div class="col-md-6 mb-md-0 mb-4"></div>
      <div class="col-md-4 text-md-right">
        <p class="copyright">
          &copy; 2020 Runtime Verification Inc. All right reserved.
        </p>
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../../assets/js/index.js"></script>
    <script>
      $(function () {
        // Render youtube video
        const anchorElements = document.querySelectorAll(".markdown-preview a");
        for (let i = anchorElements.length - 1; i >= 0; i--) {
          if (anchorElements.length - 1 - i > 3) {
            break;
          }
          const anchorElement = anchorElements[i];
          const href = anchorElement.getAttribute("href");
          if (href.match(/^https?:\/\/youtu.be\//)) {
            const match = href.match(/^https?:\/\/youtu.be\/(.+?)$/);
            if (match && match[1]) {
              const youtubeId = match[1];
              const $iframe = $(`
<div style="text-align:center;">
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/${youtubeId}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="max-width: 100%;"
  ></iframe>
  <p>The video is out of date</p>
</div>
`);
              $(anchorElement).replaceWith($iframe[0]);
            }
          }
        }
      });
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
