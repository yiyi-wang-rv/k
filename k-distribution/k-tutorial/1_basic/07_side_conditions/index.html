<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="Design and implement your programming language and software analysis tools with mathematical rigor."
/>
<meta name="keywords" content="runtime, verification, rv, k" />
<meta name="author" content="K | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />
<link rel="canonical" href="https://kframework.org/k-distribution/k-tutorial/1_basic/07_side_conditions/" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../assets/img/favicon.ico" />

<title>K | Runtime Verification Inc</title>

<!-- <base href="/k/" /> -->

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../index.html">
    <img
      class="logo-dark"
      srcset="../../../../assets/img/k-logo.png"
      alt="K"
      style="height: 48px;"
    />
    Semantic Framework
  </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/kframework/k"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../downloads"
    >Download</a
  >
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../downloads">Downloads</a>
      <a class="bd-toc-link" href="../../../../k-distribution/pl-tutorial"
        >K Tutorial</a
      >
      <a class="bd-toc-link" href="../../../../pending-documentation/"
        >User documentation</a
      >
      <a
        class="bd-toc-link"
        href="../../../../k-distribution/include/kframework/builtin/"
        >Builtins</a
      >
      <a class="bd-toc-link" href="../../../../projects">Projects using K</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="introduction markdown-preview"><html><head></head><body><h1 id="lesson-1.7%3A-side-conditions-and-rule-priority">Lesson 1.7: Side Conditions and Rule Priority</h1>
<p>The purpose of this lesson is to explain how to write conditional rules in K,
and to explain how to control the order in which rules are tried.</p>
<h2 id="side-conditions">Side Conditions</h2>
<p>So far, all of the rules we have discussed have been <strong>unconditional rules</strong>.
If the left hand side of the rule matches the arguments to the function, the
rule applies. However, there is another type of rule, a <strong>conditional rule</strong>.
A conditional rule consists of a <strong>rule body</strong> containing the patterns to
match, and a <strong>side condition</strong> representing a Boolean expression that must
evaluate to true in order for the rule to apply.</p>
<p>Side conditions in K are introduced via the <code>requires</code> keyword immediately
following the rule body. For example, here is a rule with a side condition
(<code>lesson-07-a.k</code>):</p>
<pre class="language-k"><code><span class="token keyword">module</span> LESSON<span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span>A
  <span class="token keyword">imports</span> BOOL
  <span class="token keyword">imports</span> INT

  <span class="token keyword">syntax</span> Grade <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;letter-A&quot;</span> 
                 <span class="token operator">|</span> <span class="token string">&quot;letter-B&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-C&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-D&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-F&quot;</span>
                 <span class="token operator">|</span> gradeFromPercentile<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>A <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">90</span>
<span class="token keyword">endmodule</span>
</code></pre>
<p>In this case, the <code>gradeFromPercentile</code> function takes a single integer
argument. The function evaluates to <code>letter-A</code> if the argument passed is
greater than 90. Note that the side condition is allowed to refer to variables
that appear on the left-hand-side of the rule. In the same manner as variables
appearing on the right-hand-side, variables that appear in the side condition
evaluate to the value that was matched on the left hand side. Then the
functions in the side condition are evaluated, which returns a term of sort
<code>Bool</code>. If the term is equal to <code>true</code>, then the rule applies. Bear in mind
that the side condition is only evaluated at all if the patterns on the
left-hand-side of the rule match the term being evaluated.</p>
<h3 id="exercise">Exercise</h3>
<p>Write a rule that evaluates <code>gradeFromPercentile</code> to <code>letter-B</code> if the argument
to the function is in the range [80,90). Test that the function correctly
evaluates various numbers between 80 and 100.</p>
<h2 id="owise-rules"><code>owise</code> Rules</h2>
<p>So far, all the rules we have introduced have had the same <strong>priority</strong>. What
this means is that K does not necessarily enforce an order in which the rules
are tried. We have only discussed functions so far in K, so it is not
immediately clear why this choice was made, given that a function is not
considered well-defined if multiple rules for evaluating it are capable of
evaluating the same arguments to different results. However, in future lessons
we will discuss other types of rules in K, some of which can be
<strong>nondeterministic</strong>. What this means is that if more than one rule is capable
of matching, then K will explore both possible rules in parallel, and consider
each of their respective results when executing your program. Don&apos;t worry too
much about this right now, but just understand that because of the potential
later for nondeterminism, we don&apos;t enforce a total ordering on the order in
which rules are attempted to be applied.</p>
<p>However, sometimes this is not practical; It can be very convenient to express
that a particular rule applies if no other rules for that function are
applicable. This can be expressed by adding the <code>owise</code> attribute to a rule.
What this means, in practice, is that this rule has lower priority than other
rules, and will only be tried to be applied after all the other,
higher-priority rules have been tried and they have failed.</p>
<p>For example, in the above exercise, we had to add a side condition containing
two boolean comparisons to the rule we wrote to handle <code>letter-B</code> grades.
However, in practice this meant that we compare the percentile to 90 twice. We
can more efficiently and more idiomatically write the <code>letter-B</code> case for the
<code>gradeFromPercentile</code> rule using the <code>owise</code> attribute (<code>lesson-07-b.k</code>):</p>
<pre class="language-k"><code><span class="token keyword">module</span> LESSON<span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span>B
  <span class="token keyword">imports</span> BOOL
  <span class="token keyword">imports</span> INT

  <span class="token keyword">syntax</span> Grade <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;letter-A&quot;</span> 
                 <span class="token operator">|</span> <span class="token string">&quot;letter-B&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-C&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-D&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-F&quot;</span>
                 <span class="token operator">|</span> gradeFromPercentile<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>A <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">90</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>B <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">80</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
<p>This rule is saying, &quot;if all the other rules do not apply, then the grade is a
B if the percentile is greater than or equal to 80.&quot; Note here that we use both
a side condition and an <code>owise</code> attribute on the same rule. This is not
required (as we will see later), but it is allowed. What this means is that the
side condition is only tried if the other rules did not apply <strong>and</strong> the
left-hand-side of the rule matched. You can even use more complex matching on
the left-hand-side than simply a variable. More generally, you can also have
multiple higher-priority rules, or multiple <code>owise</code> rules. What this means in
practice is that all of the non-<code>owise</code> rules are tried first, in any order,
followed by all the <code>owise</code> rules, in any order.</p>
<h3 id="exercise-1">Exercise</h3>
<p>Write another implementation of <code>gradeFromPercentile</code> which handles only the
cases for <code>D</code> and <code>F</code>, and uses the <code>owise</code> attribute to avoid redundant
boolean comparisons. Test that various percentiles in the range [0, 70) are
evaluated correctly.</p>
<h2 id="rule-priority">Rule Priority</h2>
<p>As it happens, the <code>owise</code> attribute is a specific case of a more general
concept we call <strong>rule priority</strong>. In essence, each rule is assigned an integer
priority. Rules are tried in increasing order of priority, starting with a
rule with priority zero, and trying each increasing numerical value
successively.</p>
<p>By default, a rule is assigned a priority of 50. If the rule has the <code>owise</code>
attribute, it is instead given the priority 200. You can see why this will
cause <code>owise</code> rules to be tried after regular rules.</p>
<p>However, it is also possible to directly assign a numerical priority to a rule
via the <code>priority</code> attribute. For example, here is an alternative way
we could express the same two rules in the <code>gradeFromPercentile</code> function
(<code>lesson-07-c.k</code>):</p>
<pre class="language-k"><code><span class="token keyword">module</span> LESSON<span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span>C
  <span class="token keyword">imports</span> BOOL
  <span class="token keyword">imports</span> INT

  <span class="token keyword">syntax</span> Grade <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;letter-A&quot;</span> 
                 <span class="token operator">|</span> <span class="token string">&quot;letter-B&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-C&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-D&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-F&quot;</span>
                 <span class="token operator">|</span> gradeFromPercentile<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>A <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">90</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>B <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">80</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
<p>We can, of course, assign a priority equal to any non-negative integer. For
example, here is a more complex example that handles the remaining grades
(<code>lesson-07-d.k</code>):</p>
<pre class="language-k"><code><span class="token keyword">module</span> LESSON<span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span>D
  <span class="token keyword">imports</span> BOOL
  <span class="token keyword">imports</span> INT

  <span class="token keyword">syntax</span> Grade <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">&quot;letter-A&quot;</span> 
                 <span class="token operator">|</span> <span class="token string">&quot;letter-B&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-C&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-D&quot;</span>
                 <span class="token operator">|</span> <span class="token string">&quot;letter-F&quot;</span>
                 <span class="token operator">|</span> gradeFromPercentile<span class="token punctuation">(</span><span class="token keyword">Int</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>

  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>A <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">90</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>B <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">80</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>C <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">70</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>D <span class="token keyword">requires</span> I <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">60</span> <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">rule</span> gradeFromPercentile<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> letter<span class="token operator">-</span>F                     <span class="token punctuation">[</span>priority<span class="token punctuation">(</span><span class="token number">54</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">endmodule</span>
</code></pre>
<p>Note that we have introduced a new piece of syntax here: <code>_</code>. This is actually
just a variable. However, as a special case, when a variable is named <code>_</code>, it
does not bind a value that can be used on the right hand side of the rule, or
in a side condition. Effectively, <code>_</code> is a placeholder variable that means &quot;I
don&apos;t care about this term.&quot;</p>
<p>In this example, we have explicitly expressed the order in which the rules of
this function are tried. Since rules are tried in increasing numerical
priority, we first try the rule with priority 50, then 51, then 52, 53, and
finally 54.</p>
<p>As a final note, remember that if you assign a rule a priority higher than 200,
it will be tried <strong>after</strong> a rule with the <code>owise</code> attribute, and if you assign
a rule a priority less than 50, it will be tried <strong>before</strong> a rule with no
explicit priority.</p>
<h2 id="exercises">Exercises</h2>
<ol>
<li>
<p>Write a function <code>isEven</code> that returns whether an integer is an even number.
Use two rules and one side condition. The right hand side of the rules should
be boolean literals. Refer back to
<a href="../../../include/kframework/builtin/domains/">domains.md</a> for the relevant
integer operations.</p>
</li>
<li>
<p>Modify the calculator application from lesson 1.6, problem 2, so that division
by zero will no longer make <code>krun</code> crash with a &quot;Divison by zero&quot; exception.
Instead, the <code>/</code> function should not match any of its rules if the denominator
is zero.</p>
</li>
</ol>
<h2 id="next-lesson">Next lesson</h2>
<p>Once you have completed the above exercises, you can continue to
<a href="../08_literate_programming/">Lesson 1.8: Literate Programming with Markdown</a>.</p>
</body></html></div>
        </main>
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://goo.gl/maps/NYzr2iKpXMgEmQ2F6" target="_blank"
            >102 E Main St #500, Urbana, IL 61801</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 text-md-right">
        <p class="copyright">2021 Â© all rights reserved</p>
      </div>
    </div>
  </div>
</footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../assets/js/index.js"></script>
    <script>
      $(function () {
        // Render youtube video
        const anchorElements = document.querySelectorAll(".markdown-preview a");
        for (let i = anchorElements.length - 1; i >= 0; i--) {
          if (anchorElements.length - 1 - i > 3) {
            break;
          }
          const anchorElement = anchorElements[i];
          const href = anchorElement.getAttribute("href");
          if (href.match(/^https?:\/\/youtu.be\//)) {
            const match = href.match(/^https?:\/\/youtu.be\/(.+?)$/);
            if (match && match[1]) {
              const youtubeId = match[1];
              const $iframe = $(`
<div style="text-align:center;">
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/${youtubeId}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
    style="max-width: 100%;"
  ></iframe>
  <p>The video is out of date</p>
</div>
`);
              $(anchorElement).replaceWith($iframe[0]);
            }
          }
        }
      });
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-9LBGDMRG32"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-9LBGDMRG32");
    </script>
  </body>
</html>
